<html lang="en">

<head>
<script src="//code.jquery.com/jquery-1.9.1.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.2/moment-with-locales.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.14/moment-timezone-with-data.min.js"></script>
<link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">

<style>
/* For booking table*/
caption {
    text-align: center;
}

.booking_button {
    box-shadow: 2px 3px 0px 0px #6dc754;
	background: linear-gradient(to bottom, #44c767 5%, #b3e698 100%);
	background-color: #44c767;
	border-radius: 19px;
	border: 1px solid #097a14;
	display: inline-block;
	cursor: pointer;
	color: #ffffff;
	font-family: Arial;
	font-size: 20px;
	padding: 12px 46px;
	text-decoration: none;
	text-shadow: 0px 1px 0px #2f6627;
}

.booking_button:hover {
	background: linear-gradient(to bottom, #b3e698 5%, #44c767 100%);
	background-color: #b3e698;
}
.booking_button:active {
	position: relative;
	top: 1px;
}

.booking_button:disabled,
.booking_button[disabled] {
    box-shadow: 2px 3px 0px 0px #777777;

    border: 1px solid #999999;
    background:linear-gradient(to bottom, grey 5%, grey 100%);
    background-color: #cccccc;
    color: #666666;
}

.bs_table, .bs_tr, .bs_td {
    border: 1px solid black;
    text-align: center;
}

/* For pop-up widget */
.btn-pop {
    background-color: #ffd475;  
    border-radius: 10px;
    border:0px;
    zoom:200%;
}
            
#background-pop{
    display: none;
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}
           
#div-pop{
    background:#ffffff;
    width:30%;
    z-index: 1;
    margin: 12% auto;
    overflow: auto;
}
            
.div-top{
    width: 100%;
    height: auto;
    background-color: #28a3e7;
    color: #ffffff;
}
            
.div-top div {
    padding: 3px 5px 5px 8px;
}
            
span {
    color: white;
    margin-bottom: 10px ;
    margin-left: 20px ;
    cursor: pointer;
    float: right;
}
           
.div-content {
    width: auto;
    height: 200px;
    overflow: auto;
}
            
.div-footer {
    text-align: center;
    background-color: darkgray;
}

/* For infomation card */
#info_card {
    display: inline-block;
    background-color: #efeff5;
    border: 2px solid black;
    
    border-radius: 15px;
    border-color: grey;
    
    padding: 12px;
    
    box-shadow: 4px 4px #e0e0eb;
    margin: 10px;
}

#info_card_table { 
    border-collapse: collapse; 
}

.info_card_tr + .info_card_tr {
  border-top: 1px solid black;
}

/* For toggle 1on1-group-booking_history button */
.selected_button {
    background-color: #595959;
    color: #ffffff;
    font-size: 20px;
    font-weight: bold;
    
    border: solid 3px;
    border-radius: 50%;
    border-color: white;
    height: 100px;
    width: 100px;
}

.unselected_button {
    background-color: #cccccc;
    color: #555555;
    font-size: 20px;
    font-weight: bold;
    
    border: solid 3px;
    border-radius: 50%;
    border-color: white;
    height: 100px;
    width: 100px;
}

.selected_button_div {
    border-radius: 50%;
    background-color: #595959; 
    height: 110px; 
    width: 110px; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    
    box-shadow: 4px 4px #e0e0eb;
}

.unselected_button_div {
    border-radius: 50%;
    background-color: #cccccc;
    
    height: 110px; 
    width: 110px; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    
    box-shadow: 4px 4px #eeeeee;
}

/* For the change date button */
.changeDateButton {
    background: linear-gradient(to bottom, #4d4d4d 50%, #bfbfbf 100%);
    color: white;

    font-size: 17px;
	padding: 7px 25px;
    
    border: solid 1px black;
    border-radius: 5px;
}

.changeDateButton:hover {
    background: linear-gradient(to bottom, #bfbfbf 5%, #4d4d4d 100%);
}

.changeDateButton:active {
    position: relative;
    top: 1px;
}

</style>
</head>

<body>
    <div class="container">
        <input type="datetime-local" id="pickerDateTime" />   
        <!-- <select id="dropdownTimeZone"></select> -->
        <input type="button" id="btnSubmit" onclick="submitDate()" value="Calculate" />
    </div>

    <div>
        <label>Browser/Local datetime</label>
        <div id="divLocal"></div><br>    

        <label>UTC of browser datetime</label>
        <div id="divUTC"></div><br>

        <label>Selected datetime with timezone</label>
        <div id="divSelected"></div><br>

        <label>UTC of selected datetime with timezone</label>
        <div id="divUTCSelected"></div><br> 

        <label>UTC convert into Local Time</label>
        <div id="divUTCConverted"></div><br>
    </div>

    <!-- Personal Info (info card style) -->
    <h3>登入資訊卡</h3>
    <div style="display: flex; align-items: center;">
    <div id="info_card">
        <table id="info_card_table">
            <tr class="info_card_tr">
                <td style="font-weight: bold;">ID</td>
                <td id="user_id_field" style="text-align: center"></td>
            </tr>
            <tr class="info_card_tr">
                <td style="font-weight: bold;">Username</td>
                <td id="user_name_field" style="text-align: center"></td>
            </tr>
            <tr class="info_card_tr">
                <td style="font-weight: bold;">Role</td>
                <td id="user_role_field" style="text-align: center"></td>
            </tr>
            <tr class="info_card_tr">
                <td style="font-weight: bold;">Email</td>
                <td id="user_email_field" style="text-align: center"></td>
            </tr>
            <tr class="info_card_tr">
                <td style="font-weight: bold;">Location</td>
                <td id="timeZoneField" style="text-align: right"> 
                <select id="dropdownTimeZone" onchange="dropdownTimeZoneChangeEvent()">
                </select>
                </td>
            </tr>
        </table>
    </div>

    <!-- Switch to different table mode -->
    <h3>切換表格型態</h3>
    <div style="width: auto;">
        <div style="display: inline-block; margin: 10px;">
            <div class="selected_button_div" id="button_1on1_div">
                <button class="selected_button" id="button_1on1" onclick="changeTableMode(1)">1on1</button>
            </div>
        </div>
        <div style="display: inline-block; margin: 10px;">
            <div class="unselected_button_div" id="button_group_div">
                <button class="unselected_button" id="button_group" onclick="changeTableMode(2)">group</button>
            </div>
        </div>
        <div style="display: inline-block; margin: 10px;">
            <div class="unselected_button_div" id="button_history_div">
                <button class="unselected_button" id="button_history" onclick="changeTableMode(3)">History</button>
            </div>
        </div>
    </div>
    </div>

    <!-- Booking history table -->
    <div style="display: none" id="student_book_history_info">
        <div>
            <label>查看預約的課程種類:</label>
            <button class="selected_button" style="width: 200px;" id="student_book_histroy_button_1on1" onclick="bookHistoryMode(1)">1on1</button>
            <button style="width: 200px;" id="student_book_histroy_button_group" onclick="bookHistoryMode(2)">group</button>        
        </div>
        <table class="bs_table" id="student_book_history_table">
            <tr class="bs_tr">
                <td class="bs_td">課程名稱</td>
                <td class="bs_td">課程時間</td>
                <td class="bs_td">授課老師</td>
            </tr>
            <tr class="bs_tr">
                <td class="bs_td" id="book_history_course_name_container"></td>
                <td class="bs_td" id="book_history_course_time_container"></td>
                <td class="bs_td" id="book_history_course_teacher_container"></td>
            </tr>
        </table>
    </div>

    <!-- Teacher open course history table -->
    <div style="display: none" id="teacher_open_history_info">
        <table id="teacher_open_history_table">
            <tr>
                <td>課程名稱</td>
                <td>課程時間</td>
                <td>學生人數</td>
                <td>編輯</td>
            </tr>
            <tr>
                <td id="teacher_open_history_course_name_container"></td>
                <td id="teacher_open_history_course_time_container"></td>
                <td id="teacher_open_history_course_student_container"></td>
                <td id="teacher_open_history_edit_button_container"></td>
            </tr>
        </table>
    </div>

    <div id="course_info_fields">

    <!-- Teacher Checkboxs -->
    <h3>選擇要顯示的老師課程預約時間表</h3>
    <div id="checkbox_container">
        <form id="teacher_radio_button_form">
        </form>
    </div>
    
    <!-- Change date button -->
    <h3>預約時間表</h3>
    <div style="display: flex; justify-content: space-between;">
        <button class="changeDateButton" onclick="prevDateEvent()">PREV</button>
        <button class="changeDateButton" onclick="goBackTodayEvent()">TODAY</button>
        <button class="changeDateButton" onclick="nextDateEvent()">NEXT</button>
    </div>
    
    <!-- Weekly calendar -->
    <table class="bs_table">
        <caption id="current_month"><h3></h3></caption>
        <tr class="bs_tr">
            <td class="bs_td">Mon</td>
            <td class="bs_td">Tue</td>
            <td class="bs_td">Wed</td>
            <td class="bs_td">Thu</td>
            <td class="bs_td">Fri</td>
            <td class="bs_td" style="color: red">Sat</td>
            <td class="bs_td" style="color: red">Sun</td>
        </tr>
        <tr class="bs_tr">
            <td class="bs_td" id="current_mon"></td>
            <td class="bs_td" id="current_tue"></td>
            <td class="bs_td" id="current_wed"></td>
            <td class="bs_td" id="current_thu"></td>
            <td class="bs_td" id="current_fri"></td>
            <td class="bs_td" id="current_sat" style="color: red"></td>
            <td class="bs_td" id="current_sun" style="color: red"></td>
        </tr>
        <tr class="bs_tr">
            <td class="bs_td" id="current_mon_container"></td>
            <td class="bs_td" id="current_tue_container"></td>
            <td class="bs_td" id="current_wed_container"></td>
            <td class="bs_td" id="current_thu_container"></td>
            <td class="bs_td" id="current_fri_container"></td>
            <td class="bs_td" id="current_sat_container"></td>
            <td class="bs_td" id="current_sun_container"></td>
        </tr>

        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_00">00:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_00">00:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_00">00:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_00">00:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_00">00:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_00">00:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_00">00:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_01">01:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_01">01:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_01">01:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_01">01:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_01">01:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_01">01:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_01">01:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_02">02:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_02">02:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_02">02:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_02">02:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_02">02:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_02">02:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_02">02:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_03">03:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_03">03:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_03">03:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_03">03:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_03">03:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_03">03:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_03">03:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_04">04:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_04">04:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_04">04:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_04">04:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_04">04:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_04">04:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_04">04:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_05">05:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_05">05:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_05">05:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_05">05:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_05">05:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_05">05:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_05">05:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_06">06:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_06">06:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_06">06:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_06">06:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_06">06:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_06">06:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_06">06:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_07">07:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_07">07:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_07">07:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_07">07:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_07">07:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_07">07:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_07">07:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_08">08:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_08">08:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_08">08:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_08">08:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_08">08:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_08">08:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_08">08:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_09">09:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_09">09:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_09">09:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_09">09:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_09">09:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_09">09:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_09">09:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_10">10:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_10">10:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_10">10:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_10">10:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_10">10:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_10">10:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_10">10:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_11">11:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_11">11:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_11">11:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_11">11:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_11">11:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_11">11:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_11">11:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_12">12:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_12">12:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_12">12:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_12">12:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_12">12:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_12">12:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_12">12:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_13">13:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_13">13:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_13">13:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_13">13:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_13">13:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_13">13:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_13">13:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_14">14:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_14">14:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_14">14:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_14">14:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_14">14:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_14">14:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_14">14:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_15">15:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_15">15:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_15">15:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_15">15:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_15">15:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_15">15:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_15">15:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_16">16:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_16">16:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_16">16:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_16">16:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_16">16:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_16">16:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_16">16:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_17">17:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_17">17:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_17">17:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_17">17:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_17">17:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_17">17:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_17">17:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_18">18:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_18">18:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_18">18:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_18">18:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_18">18:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_18">18:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_18">18:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_19">19:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_19">19:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_19">19:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_19">19:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_19">19:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_19">19:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_19">19:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_20">20:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_20">20:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_20">20:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_20">20:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_20">20:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_20">20:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_20">20:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_21">21:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_21">21:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_21">21:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_21">21:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_21">21:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_21">21:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_21">21:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_22">22:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_22">22:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_22">22:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_22">22:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_22">22:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_22">22:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_22">22:00</button>
            </td>
        </tr>
    
        <tr class="bs_tr">
            <td class="bs_td"">
                <button disabled class="booking_button" id="mon_btn_23">23:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="tue_btn_23">23:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="wed_btn_23">23:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="thu_btn_23">23:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="fri_btn_23">23:00</button>
            </td>
            <td class="bs_td">                
                <button disabled class="booking_button" id="sat_btn_23">23:00</button>
            </td>
            <td class="bs_td">
                <button disabled class="booking_button" id="sun_btn_23">23:00</button>
            </td>
        </tr>
    </table>

    <!-- Teacher can set the course info -->
    <div style="display: none" id="teacher_course_settings">
    <dl>
        <dt>
            <p>Teacher:<input type="text" id="tname" name="tname"></p>
        </dt>
        <dt>
            <p>Date:<input type="text" class="datepicker" id="datepicker"></p>
        </dt>
        <dt>
            <p>Start Time:<input type="text" class="timepicker" id="course_start_time"></p>
        </dt>
        <dt>
            <p>End Time:<input type="text" class="timepicker" id="course_end_time"></p>
        </dt>
        <dt style="display: none" id="student_max_num_field">
            <p>Student Max Number:<input type="text" id="student_max_num"></p>
        </dt>
        <dt>
            <p>Price:<input type="text" id="course_price"></p>
        </dt>
    </dl>
        <button style="float: right;" onclick="add_new_course()">CREATE</button>
    </div>
    </div>

    <!-- Pop booking window -->
    <div id="background-pop">
        <div id="div-pop">
            <div class="div-top">
                <span id="close-button">[X]</span>
                <div>Check your user information...</div>
            </div>
            <div class="div-content">
                <p>Username:<input type="text" id="pay_user_name"></p>
                <p>Email:<input type="text" id="pay_user_email"></p>
            
                <!-- Auto generate PayPal button -->
                <!-- TODO action URL need to switch with admin backend settings -->
                <div style='margin-left: auto;margin-right: auto;width:170px'>
                    <form action='https://www.sandbox.paypal.com/cgi-bin/webscr' method='post'>
                        <input type='hidden' name='cmd' value='_xclick' />
                        <input type='hidden' name='business' value='sb-3lpsb8564015@business.example.com' />
                        <input type='hidden' id='ca_booking_name' name='item_name' value='THIS_IS_A_COURSE_WITH_DATETIEM!!!!' />
                        <input type='hidden' name='currency_code' value='USD' />
                        <input type='hidden' id='ca_booking_value' name='amount' value='0.99' />
                        <input type='hidden' name='lc' value='EN_US'>
                        <input type='hidden' name='no_note' value=''>
                        <input type='hidden' name='paymentaction' value='sale'>
                        <input type='hidden' name='return' value='' />
                        <input type='hidden' name='bn' value='WPPlugin_SP'>
                        <input type='hidden' name='cancel_return' value='' />
                        <input type="hidden" id='ca_booking_username' name="custom" value="mycustomvalue">
                        <input style='border: none;' class='paypalbuttonimage' type='image' 
                            src='https://www.paypalobjects.com/webstatic/en_US/i/buttons/buy-logo-medium.png' border='0' name='submit'
                            alt='Make your payments with PayPal. It is free, secure, effective.'>
                        <img alt='' border='0' style='border:none;display:none;' src='https://www.paypal.com/EN_US/i/scr/pixel.gif' width='1' height='1'>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>


<script>
    // Settings
    let booking_data_1on1;
    let booking_keys_1on1;
    let booking_data_group;
    let booking_keys_group;
    var current_utc;
    var table_mode = 1;
    var teacher_names;
    var teacher_ids;

    var booking_buttons = [];

    const _months = [
        'January',
        'February',
        'March',
        'April',
        'May',
        'June',
        'July',
        'August',
        'September',
        'October',
        'November',
        'December'
    ];
    const _weekdays = [
        'Sunday',
        'Monday',
        'Tuesday',
        'Wednesday',
        'Thrusday',
        'Friday',
        'Saturday',
    ];

    let weekday_ids = [
        "mon",
        "tue",
        "wed",
        "thu",
        "fri",
        "sat",
        "sun"
    ];


    const _offset2UTC = {
        "0": "UTC+0",
        "60": "UTC-1",
        "120": "UTC-2",
        "180": "UTC-3",
        "240": "UTC-4",
        "300": "UTC-5",
        "360": "UTC-6",
        "420": "UTC-7",
        "480": "UTC-8",
        "540": "UTC-9",
        "600": "UTC-10",
        "660": "UTC-11",
        "720": "UTC-12",
        "-60": "UTC+1",
        "-120": "UTC+2",
        "-180": "UTC+3",
        "-240": "UTC+4",
        "-300": "UTC+5",
        "-360": "UTC+6",
        "-420": "UTC+7",
        "-480": "UTC+8",
        "-540": "UTC+9",
        "-600": "UTC+10",
        "-660": "UTC+11",
        "-720": "UTC+12",
        "-780": "UTC+13",
        "-840": "UTC+14",
    };

    const teacher_open_course_colors = [
        "#ff8c00",
        "#9932cc",
        "#8b0000",
        "#9400d3",
        "#00ced1",
        "#696969"
    ];

    // Initialize the today date and move it to monday
    var _date = new Date();

    // Init() is the entry point
    function Init() {
        $.ajax({
            type: "POST",
            url: ca_process_url,
            data: {
                "type": "init",
            },
            dataType: "json",
            success: function (init_data) {
                remove_all_display_booking_data();
                
                // Date set to monday (the start point of a new week)
                _date = new Date();
                if (_date.getDay() == 0) _date.setDate(_date.getDate()-6);
                else _date.setDate(_date.getDate()-_date.getDay()+1);

                document.getElementById("user_id_field").innerHTML = init_data.current_user_id;
                document.getElementById("user_name_field").innerHTML = init_data.current_user_name;
                document.getElementById("user_role_field").innerHTML = init_data.current_user_role;
                document.getElementById("user_email_field").innerHTML = init_data.current_user_email;

                // Initialize checkboxs
                teacher_names = init_data.teachers;
                teacher_ids = init_data.teachers_id;
                checkbox_init(teacher_names, teacher_ids);

                // If user role is teacher, he/she can add the new course on the booking system
                if (init_data.current_user_role == "um_teacher") {
                    document.getElementById("teacher_course_settings").style.display = "block";
                    document.getElementById("tname").value = init_data.current_user_name;
                    document.getElementById("tname").disabled = true;
                }
                    
                // Hide the student max num field
                document.getElementById("student_max_num_field").style.display = "none";

                booking_data_1on1 = convertBookingDataUTC(init_data.booking_data_1on1);
                booking_keys_1on1 = init_data.booking_keys_1on1;
                booking_data_group = convertBookingDataUTC(init_data.booking_data_group);
                booking_keys_group = init_data.booking_keys_group;

                setWeekDate(1);
                // current_utc = document.getElementById("UTC_Timezone").value;

                // Book history
                bookHistoryMode(1);

                // Open course history
                openHistory();
            },
            error: function (xhr, s, error) {
                alert(xhr.status);
                alert(xhr.readyState);
                alert(xhr.responseText);
                alert(xhr.statusText);
            },
        });
    }

    function Add_New_Course_1on1(tname, _date, start_time, end_time, price) {
        var selected_utc = document.getElementById("UTC_Timezone").value;
        var utc_offset = -1 * parseInt(selected_utc.split("UTC")[1]);
        var start_time_timestamps = start_time.getTime();
        var end_time_timestamps = end_time.getTime();

        start_time.setTime(start_time_timestamps + utc_offset * 1000 * 60 * 60);
        end_time.setTime(end_time_timestamps + utc_offset * 1000 * 60 * 60);
        
        // Time
        var _st = start_time.getHours().toString() + ":" + start_time.getMinutes().toString();
        var _et = end_time.getHours().toString() + ":" + end_time.getMinutes().toString();

        $.ajax({
            type: "POST",
            url: ca_process_url,
            data: {
                "type": "add_new_course_1on1",
                "teacher_name": tname,
                "date": _date,
                "start_time": _st,
                "end_time": _et,
                "price": price,
            },
            dataType: "json",
            success: function(results) {
                // alert(results.message);
            },
            error: function (xhr, s, error) {
                alert(xhr.status);
                alert(xhr.readyState);
                alert(xhr.responseText);
                alert(xhr.statusText);
            },
        });
    }

    function Add_New_Course_Group(tname, _date, start_time, end_time, student_max_num, price) {
        var selected_utc = document.getElementById("UTC_Timezone").value;
        var utc_offset = -1 * parseInt(selected_utc.split("UTC")[1]);
        var start_time_timestamps = start_time.getTime();
        var end_time_timestamps = end_time.getTime();

        start_time.setTime(start_time_timestamps + utc_offset * 1000 * 60 * 60);
        end_time.setTime(end_time_timestamps + utc_offset * 1000 * 60 * 60);
        
        // Time
        var _st = start_time.getHours().toString() + ":" + start_time.getMinutes().toString();
        var _et = end_time.getHours().toString() + ":" + end_time.getMinutes().toString();

        $.ajax({
            type: "POST",
            url: ca_process_url,
            data: {
                "type": "add_new_course_group",
                "teacher_name": tname,
                "date": _date,
                "start_time": _st,
                "end_time": _et,
                "student_max_num": student_max_num,
                "price": price,
            },
            dataType: "json",
            success: function(results) {
                // alert(results.message);
            },
            error: function (xhr, s, error) {
                alert(xhr.status);
                alert(xhr.readyState);
                alert(xhr.responseText);
                alert(xhr.statusText);
            },
        });
    }

    function Before_Booking_Check_1on1(book_course_key, book_value, book_user_name, book_user_email) {
        $.ajax({
            type: "POST",
            url: ca_process_url,
            data: {
                "type": "before_booking_check_1on1",
                "book_course_key": book_course_key,
                "book_user_name": book_user_name,
                "book_user_email": book_user_email,
            },
            dataType: "json",
            success: function (check_results) {
                if (check_results.results == "ok") {
                    payEvent(book_course_key, book_value);
                }
                else if (check_results.results == "wait for payment") {
                    payEvent(book_course_key, book_value);
                }
                else if (check_results.results == "not you") {
                    alert("The course is booked by other people!");
                }
                else {
                    alert("The course is booked.");
                }
            },
            error: function (xhr, s, error) {
                alert(xhr.status);
                alert(xhr.readyState);
                alert(xhr.responseText);
                alert(xhr.statusText);
            },
        });
    }

    function Before_Booking_Check_Group(book_course_key, book_value, book_user_name, book_user_email) {
        $.ajax({
            type: "POST",
            url: ca_process_url,
            data: {
                "type": "before_booking_check_group",
                "book_course_key": book_course_key,
                "book_user_name": book_user_name,
                "book_user_email": book_user_email,
            },
            dataType: "json",
            success: function (check_results) {
                if (check_results.results == "group course can book" || check_results.results == "you need to pay!") {
                    payEvent(book_course_key, book_value);
                }
                else {
                    alert(check_results.results);
                }
            },
            error: function (xhr, s, error) {
                alert(xhr.status);
                alert(xhr.readyState);
                alert(xhr.responseText);
                alert(xhr.statusText);
            },
        });
    }

    function Delete_Course(book_course_key) {
        alert("The following course you want to delete:");
        alert(book_course_key);

        $.ajax({
            type: "POST",
            url: ca_process_url,
            data: {
                "type": "delete_course",
                "delete_course_key": book_course_key,
            },
            dataType: "json",
            success: function (results) {
                alert("delete successfully!");
                window.location.reload();
            },
            error: function (xhr, s, error) {
                alert(xhr.status);
                alert(xhr.readyState);
                alert(xhr.responseText);
                alert(xhr.statusText);
            },
        });
    }

    // Format method
    function formatDate(format_date) {
        let month = (1 + format_date.getMonth()).toString().padStart(2, '0');
        let day = format_date.getDate().toString().padStart(2, '0');

        return month + '/' + day;
    }

    // Checkbox init
    function checkbox_init(names, ids) {
        var container = document.getElementById("teacher_radio_button_form");
        while (container.lastElementChild) {
            container.removeChild(container.lastElementChild);
        }

        // Add checkboxs
        for (var i=0; i<names.length; ++i) {
            // Checkbox
            var radio_button = document.createElement("input");
            radio_button.type = "radio";
            radio_button.name = "teacher_radio_button";
            radio_button.value = names[i];
            radio_button.id = ids[i];

            if (i == 0) radio_button.checked = true;
            else radio_button.checked = false;

            radio_button.onchange = function() {
                // alert(this.value);
                remove_all_display_booking_data();
                setWeekDate(0);
            };
        
            // Label (for displaying teacher name)
            var name_label = document.createElement("label");
            name_label.htmlFor = ids[i];
            name_label.appendChild(document.createTextNode(names[i]));
            name_label.style.color = teacher_open_course_colors[i];

            // Button style label (for displaying teacher name)
            var name_button = document.createElement("button");
            name_button.htmlFor = ids[i];
            name_button.innerHTML = names[i];
            // name_button.className = "booking_button";
            name_button.style.border = "solid 1px";
            name_button.style.borderRadius = "2px";
            name_button.style.backgroundColor = "#66ff66";
            name_button.style.padding = "5px";
            name_button.style.marginLeft = "5px";
            // name_button.style.fontSize = "15px";
            

            // <br> element
            var newlineElement = document.createElement("br");
            // var spaceElement = document.createElemet("p");
            // spaceElement.innerText = "  ";
            
            // Append
            container.appendChild(radio_button);
            // container.appendChild(name_label);
            // container.appendChild(spaceElement);
            container.appendChild(name_button);
            container.appendChild(newlineElement);
        }
    }

    // Convert UTC
    function convertBookingDataUTC(booking_data) {
        for (let i=0; i<booking_data.length; ++i) {
            var _d = booking_data[i]["date"];
            var _st = booking_data[i]["start_time"];
            var _et = booking_data[i]["end_time"];
            
            var _start_time = moment.utc(_d+" "+_st);
            var _end_time = moment.utc(_d+" "+_et);

            // Current UTC
            let timeZoneValue = document.getElementById("dropdownTimeZone").value;

            // Convert
            // if (i == 0) alert(_start_time);
            _start_time = moment.tz(_start_time, timeZoneValue);

            // if (i == 0) alert(_start_time);
            _end_time = moment.tz(_end_time, timeZoneValue);

            // Save
            _d = _start_time.format("YYYY-MM-DD");
            _st = _start_time.format("HH:mm");
            _et = _end_time.format("HH:mm");

            // if (i == 0) alert(_d);
            // if (i == 0) alert(_st);
            // if (i == 0) alert(_et);

            booking_data[i]["date"] = _d;
            booking_data[i]["start_time"] = _st;
            booking_data[i]["end_time"] = _et;
        }

        return booking_data;
    }

    // Convert UTC from current to new
    function utcChangeEvent() {
        remove_all_display_booking_data();
        var selected_utc = document.getElementById("UTC_Timezone").value;
        var new_utc = parseInt(selected_utc.split("UTC")[1]);
        var old_utc = parseInt(current_utc.split("UTC")[1]);
        var utc_offset = new_utc - old_utc;

        // Update
        current_utc = selected_utc;
        
        for (let i=0; i<booking_data_1on1.length; ++i) {
            var _date = booking_data_1on1[i]["date"];
            var _st = booking_data_1on1[i]["start_time"];
            var _et = booking_data_1on1[i]["end_time"];
            
            var _start_time = new Date(_date);
            _start_time.setHours(parseInt(_st.split(":")[0], parseInt(_st.split(":")[1]), 0));
                
            var _end_time = new Date(_date);
            _end_time.setHours(parseInt(_et.split(":")[0], parseInt(_et.split(":")[1]), 0));
            
            // Convert
            _start_time.setTime(_start_time.getTime() + utc_offset * 1000 * 60 * 60);
            _end_time.setTime(_end_time.getTime() + utc_offset * 1000 * 60 * 60);

            // Save
            // Date
            var y = _start_time.getFullYear().toString();
            var m = _start_time.getMonth() + 1;
            if (m < 10) m = "0" + m.toString();
            else m = m.toString();
            var d = _start_time.getDate();
            if (d < 10) d = "0" + d.toString();
            var _date = y + "-" + m + "-" + d;

            // Time
            var _st = _start_time.getHours().toString() + ":" + _start_time.getMinutes().toString();
            var _et = _end_time.getHours().toString() + ":" + _end_time.getMinutes().toString();

            booking_data_1on1[i]["date"] = _date;
            booking_data_1on1[i]["start_time"] = _st;
            booking_data_1on1[i]["end_time"] = _et;
        }

        for (let i=0; i<booking_data_group.length; ++i) {
            var _date = booking_data_group[i]["date"];
            var _st = booking_data_group[i]["start_time"];
            var _et = booking_data_group[i]["end_time"];
            
            var _start_time = new Date(_date);
            _start_time.setHours(parseInt(_st.split(":")[0], parseInt(_st.split(":")[1]), 0));
                
            var _end_time = new Date(_date);
            _end_time.setHours(parseInt(_et.split(":")[0], parseInt(_et.split(":")[1]), 0));
            
            // Convert
            _start_time.setTime(_start_time.getTime() + utc_offset * 1000 * 60 * 60);
            _end_time.setTime(_end_time.getTime() + utc_offset * 1000 * 60 * 60);

            // Save
            // Date
            var y = _start_time.getFullYear().toString();
            var m = _start_time.getMonth() + 1;
            if (m < 10) m = "0" + m.toString();
            else m = m.toString();
            var d = _start_time.getDate();
            if (d < 10) d = "0" + d.toString();
            var _date = y + "-" + m + "-" + d;

            // Time
            var _st = _start_time.getHours().toString() + ":" + _start_time.getMinutes().toString();
            var _et = _end_time.getHours().toString() + ":" + _end_time.getMinutes().toString();

            booking_data_group[i]["date"] = _date;
            booking_data_group[i]["start_time"] = _st;
            booking_data_group[i]["end_time"] = _et;
        }

        setWeekDate(0);
    }

    // Set date
    function setWeekDate(direction) {
        if (table_mode == 1) booking_data = booking_data_1on1;
        else if (table_mode == 2) booking_data = booking_data_group;

        // Direction
        if (direction == -1) {
            _date.setDate(_date.getDate()-14);
        }
        if (direction == 0) {
            _date.setDate(_date.getDate()-7);
        }

        // Months and Years
        const months = [];
        const years = [];

        // Current weekday
        months[0] = _date.getMonth();
        years[0] = _date.getFullYear();

        // Filter
        var checkboxs = Array.from(document.getElementsByName("teacher_radio_button"));
        var checked_teacher;
        checkboxs.forEach( function(v) {
            if (v.checked == true) {
                checked_teacher = v.value;
            }
        });

        // Clear enabled button
        for (let i=0; i<booking_buttons.length; ++i) {
            booking_buttons[i].disabled = true;
        }
        booking_buttons.length = 0;

        for (let i=0; i<7; ++i) {
            // if (i == 0) alert(_date);

            document.getElementById("current_"+weekday_ids[i]).innerHTML = formatDate(_date);
            
            // if (i == 0) alert(_date);

            if (months[0] != _date.getMonth()) months[1] = _date.getMonth();
            if (years[0] != _date.getFullYear()) years[1] = _date.getFullYear();

            // Display Course info
            var y = _date.getFullYear();
            var m = _date.getMonth() + 1;
            if (m < 10) m = "0" + m.toString();
            else m = m.toString();
            var d = _date.getDate();
            if (d < 10) d = "0" + d.toString();
            else d = d.toString();
            cur_date = y + "-" + m + "-" + d;

            // if (i == 0) alert(cur_date);

            // Button template
            var button_num = 0;
            var td_container = document.getElementById("current_"+weekday_ids[i]+"_container");

            for (var j=0; j<booking_data.length; ++j) {
                // if (unchecked_teachers.includes(booking_data[j]["teacher_name"])) continue;
                if (checked_teacher != booking_data[j]["teacher_name"]) continue;

                var t = 0;
                for (t=0; t<teacher_names.length; ++t) {
                    if (teacher_names[t] == booking_data[j]["teacher_name"]) break;
                }

                // alert(cur_date);
                // alert(booking_data[j]["date"]);
                if (cur_date == booking_data[j]["date"]) {
                    alert(cur_date);
                    alert(booking_data[j]["date"]);
                    alert(booking_data[j]["start_time"]);

                    var st_h = booking_data[j]["start_time"].split(":")[0];
                    var st_m = booking_data[j]["start_time"].split(":")[1];
                    var et_h = booking_data[j]["end_time"].split(":")[0];
                    var et_m = booking_data[j]["end_time"].split(":")[1];
                    
                    // if (parseInt(st_h) < 10) st_h = "0" + st_h;
                    // if (parseInt(st_m) < 10) st_m = "0" + st_m;
                    // if (parseInt(et_h) < 10) et_h = "0" + et_h;
                    // if (parseInt(et_m) < 10) et_m = "0" + et_m;

                    var book_button = document.createElement("input");
                    book_button.type = "button";
                    book_button.value = st_h + ":" + st_m + "-" + et_h + ":" + et_m + "\n$" + booking_data[j]["price"] + " USD";
                    
                    if (table_mode == 1) {
                        if (booking_data[j]["status"] == "booked") {
                            book_button.value += "\n(已預約)";
                        }
                        else if (booking_data[j]["status"] == "booking") {
                            book_button.value += "\n(等待付款中...)";
                        }
                    }
                    else if (table_mode == 2) {
                        var student_num = booking_data[j]["student_names"].length.toString();
                        var max_student_num = booking_data[j]["student_max_num"];
                        book_button.value += "\b(" + student_num + "/" + max_student_num + ")";
                    }
                    
                    // Attribute "name" is store the key and data index
                    // ------------------------------------------------
                    book_button.name = j.toString();
                    // ------------------------------------------------

                    book_button.onclick = bookButtonEvent;

                    // Button colors
                    book_button.style.backgroundColor = teacher_open_course_colors[t];

                    td_container.appendChild(book_button);
                    ++button_num;

                    // NEW BUTTON EVENT =================================================
                    let btnid = weekday_ids[i]+"_btn_"+st_h;
                    // alert(btnid);

                    var btn = document.getElementById(btnid);
                    btn.disabled = false;
                    booking_buttons.push(btn);
                    // NEW BUTTON EVENT =================================================
                }
            }
            
            // Date forward
            _date.setDate(_date.getDate()+1);
        }

        // Current Month and Year
        if (months.length == 2 && years.length == 2) {
            document.getElementById('current_month').innerHTML = _months[months[0]] + ' ' + years[0] + ' - ' + _months[months[1]] + " " + years[1];
        }
        else if (months.length == 2) {
            document.getElementById('current_month').innerHTML = _months[months[0]] + ' ' + years[0] + ' - ' + _months[months[1]] + " " + years[0];         
        }
        else {
            document.getElementById('current_month').innerHTML = _months[_date.getMonth()] + ' ' + _date.getFullYear();
        }
    }

    // UTC timezone select
    function autoSelectLocalUTC(n) {
        var n = n + 12;
        document.getElementById('UTC_Timezone').selectedIndex = n;
    }

    // Move display week event
    function nextDateEvent() {
        remove_all_display_booking_data();
        setWeekDate(1);
    }

    function prevDateEvent() {
        remove_all_display_booking_data();
        setWeekDate(-1);
    }

    function goBackTodayEvent() {
        remove_all_display_booking_data();
        _date = new Date();
        _date.setDate(_date.getDate()-_date.getDay()+1);
        setWeekDate(1);
    }

    function remove_all_display_booking_data() {
        for (let i=0; i<7; ++i) {
            var td_container = document.getElementById("current_"+weekday_ids[i]+"_container");
            while (td_container.lastElementChild) {
                td_container.removeChild(td_container.lastElementChild);
            }
        }
    }


    // Calendar widget
    $(function() {
        $( "#datepicker" ).datepicker({
            dateFormat: "yy-mm-dd",
        });

        $(".timepicker").timepicker({
            "timeFormat": "H:mm"
        });
    });

    // Determine a text is a number or not
    function isNumber(inputData) {
        return parseFloat(inputData).toString() != "NaN";
    }

    // Add new course
    function add_new_course() {
        // Instance
        var datepicker_object = document.getElementById("datepicker");
        var course_start_time_object = document.getElementById("course_start_time");
        var course_end_time_object = document.getElementById("course_end_time");
        var course_price_object = document.getElementById("course_price");
        var course_student_max_num_object = document.getElementById("student_max_num");

        // Check
        if (datepicker_object.value == "") {
            alert("The date field cannot be empty!");
        }
        else if (course_start_time_object.value == "") {
            alert("The start time field cannot be empty!");
        }
        else if (course_end_time_object.value == "") {
            alert("The end time field cannot be empty!");
        }
        else if (course_price_object.value == "") {
            alert("The price field cannot be empty!");
        }
        else if (table_mode == 2 && course_student_max_num_object.value == "") {
            alert("The student max number cannot be empty!");
        }
        else if (isNumber(course_price_object.value) == false) {
            alert("The price must be a number!");
        }
        else {
            var start_time = course_start_time_object.value;
            var end_time = course_end_time_object.value;
            var start_hour = parseInt(start_time.split(":")[0]);
            var start_min = parseInt(start_time.split(":")[1]);
            var end_hour = parseInt(end_time.split(":")[0]);
            var end_min = parseInt(end_time.split(":")[1]);

            // Re-declare start_time and end_time
            var start_time = new Date(datepicker_object.value);
            var end_time = new Date(datepicker_object.value);
            start_time.setHours(start_hour, start_min, 0);
            end_time.setHours(end_hour, end_min, 0);

            // Max student number
            var student_max_num = 0;
            if (table_mode == 2) {
                student_max_num = course_student_max_num_object.value;
            }

            // Check
            if (start_time < end_time) {
                if (table_mode == 1) {
                    Add_New_Course_1on1(
                        document.getElementById("tname").value,
                        datepicker_object.value,
                        start_time,
                        end_time,
                        course_price_object.value,
                    );
                }
                else if (table_mode == 2) {
                    Add_New_Course_Group(
                        document.getElementById("tname").value,
                        datepicker_object.value,
                        start_time,
                        end_time,
                        student_max_num,
                        course_price_object.value,
                    );
                }

                var successed_message = "The course " + datepicker_object.value + " " + course_start_time_object.value + "-" + course_end_time_object.value + " ($" + course_price_object.value + " USD) is add to the booking system!";
                alert(successed_message);
                datepicker_object.value = "";
                course_start_time_object.value = "";
                course_end_time_object.value = "";
                course_price_object.value = "";
                window.location.reload();
            }
            else {
                alert("結束時間不可以設定得比開始時間早！");
            }    
        }
    }

    // Book button event
    function bookButtonEvent() {
        alert(document.getElementById("user_name_field").innerHTML.split(" ")[1]);
        alert(booking_data[parseInt(this.name)]["teacher_name"]);
        alert("Enter bookButtonEvent!");

        if (table_mode == 1) {
            booking_data = booking_data_1on1;
            booking_keys = booking_keys_1on1;
        }
        else if (table_mode == 2) {
            booking_data = booking_data_group;
            booking_keys = booking_keys_group;
        }
        
        var ca_booking_name = booking_keys[parseInt(this.name)];
        var ca_booking_value = booking_data[parseInt(this.name)]["price"];

        alert(ca_booking_name);
        alert(ca_booking_value);

        // If the current visitor has not login
        if (document.getElementById("user_name_field").innerHTML == "false") {
            alert("you must be logged in for booking.");
            location.replace("https://allthing-can.com/login/");
        }

        // If the current user is the course teacher
        else if (document.getElementById("user_name_field").innerHTML.split(" ")[1] == booking_data[parseInt(this.name)]["teacher_name"]) {
            if (window.confirm("Do you want to delete the course?") == true) {
                Delete_Course(ca_booking_name);
            }
        }

        else {
            if (window.confirm("Do you want to book?") == true) {
                alert("YES!");
                
                var book_user_name = document.getElementById("user_name_field").innerHTML.split(" ")[1];
                var book_user_email = document.getElementById("user_email_field").innerHTML.split(" ")[1];
        
                if (table_mode == 1) {
                    Before_Booking_Check_1on1(ca_booking_name, ca_booking_value, book_user_name, book_user_email);
                }
                else if (table_mode == 2) {
                    Before_Booking_Check_Group(ca_booking_name, ca_booking_value, book_user_name, book_user_email);
                }
            } 
            else {
                alert("CANCEL!");
            }
        }
    }

    function payEvent(ca_booking_name, ca_booking_value) {
        // PayPal button
        document.getElementById("ca_booking_name").value = ca_booking_name;
        document.getElementById("ca_booking_value").value = ca_booking_value;

        // Show or Hide
        var div = document.getElementById("background-pop");
        var close = document.getElementById("close-button");

        // User info
        var book_user_name = document.getElementById("user_name_field").innerHTML.split(" ")[1];
        var book_user_email = document.getElementById("user_email_field").innerHTML.split(" ")[1];
        document.getElementById("pay_user_name").value = book_user_name;
        document.getElementById("ca_booking_username").value = book_user_name;
        document.getElementById("pay_user_email").value = book_user_email;

        div.style.display = "block";

        close.onclick = function close() {
            div.style.display = "none";
        }

        window.onclick = function close(e) {
            if (e.target == div) {
                div.style.display = "none";
            }
        }

        // Book event
        book(ca_book_name, book_user_name, book_user_email);
    }

    // Change the course type (1on1 or Group)
    function changeTableMode(mode) {
        table_mode = mode;

        var button_1on1 = document.getElementById("button_1on1");
        var button_group = document.getElementById("button_group");
        var button_history = document.getElementById("button_history");
        var button_1on1_div = document.getElementById("button_1on1_div");
        var button_group_div = document.getElementById("button_group_div");
        var button_history_div = document.getElementById("button_history_div");

        const button_list = [button_1on1, button_group, button_history];
        const button_div_list = [button_1on1_div, button_group_div, button_history_div];

        button_list.forEach(removeAllButtonClass);
        button_div_list.forEach(removeAllButtonDivClass);

        function removeAllButtonClass(button) {
            button.className = "unselected_button";
        }

        function removeAllButtonDivClass(buttonDiv) {
            buttonDiv.className = "unselected_button_div";
        }

        var course_info_fields = document.getElementById("course_info_fields");
        var book_info_fields = document.getElementById("student_book_history_info");
        var teacher_open_fields = document.getElementById("teacher_open_history_info");

        if (mode == 1) {
            button_1on1.className = "selected_button";
            button_1on1_div.className = "selected_button_div";
            course_info_fields.style.display = "block";
            book_info_fields.style.display = "none";
            teacher_open_fields.style.display = "none";
            remove_all_display_booking_data();
            setWeekDate(0);
        }
        else if (mode == 2) {
            button_group.className = "selected_button";
            button_group_div.className = "selected_button_div";

            course_info_fields.style.display = "block";
            book_info_fields.style.display = "none";
            teacher_open_fields.style.display = "none";
            remove_all_display_booking_data();
            setWeekDate(0);
        }
        else if (mode == 3) {
            button_history.className = "selected_button";
            button_history_div.className = "selected_button_div";

            course_info_fields.style.display = "none";
            book_info_fields.style.display = "block";
            teacher_open_fields.style.display = "block";
        }
    }

    function bookHistoryMode(mode) {
        // Change button color
        var student_book_history_button_1on1 = document.getElementById("student_book_histroy_button_1on1");
        var student_book_histroy_button_group = document.getElementById("student_book_histroy_button_group");

        const button_list = [student_book_history_button_1on1, student_book_histroy_button_group];
        button_list.forEach(removeAllButtonClass);

        function removeAllButtonClass(button) {
            if (button.classList.contains("selected_button")) {
                button.classList.remove("selected_button");
            }
        }

        // Clear table
        var table_container = document.getElementById("student_book_history_table");
        while (table_container.rows.length > 1) table_container.deleteRow(1);

        if (mode == 1) student_book_histroy_button_1on1.classList.add("selected_button");
        else if (mode == 2) student_book_histroy_button_group.classList.add("selected_button");

        function setBookHistoryTable(data) {
            let new_row = table_container.insertRow(-1);
            let course_cell = new_row.insertCell(0);
            let time_cell = new_row.insertCell(1);
            let teacher_cell = new_row.insertCell(2);

            let course_name = document.createTextNode(data[0]);
            let course_time = document.createTextNode(data[1]);
            let course_teacher = document.createTextNode(data[2]);

            course_cell.appendChild(course_name);
            time_cell.appendChild(course_time);
            teacher_cell.appendChild(course_teacher);
        }

        var current_username = document.getElementById("user_name_field").innerHTML.split(" ")[1];
        var current_user_1on1_book_data = [];
        var current_user_group_book_data = [];

        for (var i=0; i<booking_data_1on1.length; ++i) {
            if (booking_data_1on1[i]["student_name"] == current_username) {
                current_user_1on1_book_data.push([
                    booking_keys_1on1[i],
                    booking_data_1on1[i]["start_time"] + "-" + booking_data_1on1[i]["end_time"],
                    booking_data_1on1[i]["teacher_name"]
                ]);
            }
        }

        for (var i=0; i<booking_data_group.length; ++i) {
            if (booking_data_group[i]["student_names"].includes(current_username)) {
                current_user_group_book_data.push([
                    booking_keys_group[i],
                    booking_data_group[i]["start_time"] + "-" + booking_data_group[i]["end_time"],
                    booking_data_group[i]["teacher_name"]
                ]);
            }
        }

        if (mode == 1) current_user_1on1_book_data.forEach(setBookHistoryTable);
        else if (mode == 2) current_user_group_book_data.forEach(setBookHistoryTable);
    }

    function openHistory() {
        var table_container = document.getElementById("teacher_open_history_table");
        var current_username = document.getElementById("user_name_field").innerHTML.split(" ")[1];

        function setBookHistoryTable(data) {
            let new_row = table_container.insertRow(-1);
            let course_cell = new_row.insertCell(0);
            let time_cell = new_row.insertCell(1);
            let student_cell = new_row.insertCell(2);
            let edit_cell = new_row.insertCell(3);

            let course_name = document.createTextNode(data[0]);
            let course_time = document.createTextNode(data[1]);
            let course_students = document.createTextNode(data[2]);

            course_cell.appendChild(course_name);
            time_cell.appendChild(course_time);
            student_cell.appendChild(course_students);
        }

        var current_user_1on1_book_data = [];
        var current_user_group_book_data = [];

        for (var i=0; i<booking_data_1on1.length; ++i) {
            if (booking_data_1on1[i]["teacher_name"] == current_username) {
                var temp_data = [
                    booking_keys_1on1[i],
                    booking_data_1on1[i]["start_time"] + "-" + booking_data_1on1[i]["end_time"],
                ]

                if (booking_data_1on1[i]["student_name"] != "") {
                    temp_data.push("(1/1) "+booking_data_1on1[i]["student_name"]);
                }
                else {
                    temp_data.push("(0/1)");
                }

                current_user_1on1_book_data.push(temp_data);
            }
        }

        for (var i=0; i<booking_data_group.length; ++i) {
            if (booking_data_group[i]["teacher_name"] == current_username) {
                current_user_group_book_data.push([
                    booking_keys_group[i],
                    booking_data_group[i]["start_time"] + "-" + booking_data_group[i]["end_time"],
                    "("+booking_data_group[i]["student_names"].length.toString()+"/"+booking_data_group[i]["student_max_num"]+")"
                ]);
            }
        }

        current_user_group_book_data.forEach(setBookHistoryTable);
        current_user_1on1_book_data.forEach(setBookHistoryTable);
    }

    function loadTimeZoneList() {
        let select = document.getElementById("dropdownTimeZone");
        select.innerHTML = ""; 

        let browserTimeZone = moment.tz.guess();
        let timeZones = moment.tz.names();

        timeZones.forEach((timeZone) => {
            option = document.createElement("option");      
            option.textContent = `${timeZone} (GMT${moment.tz(timeZone).format('Z')})`; 
            option.value = timeZone;
     
            if (timeZone == browserTimeZone){
                option.selected = true;
            }
        
            select.appendChild(option);
        });
    }

    function loadDefaultDateTime() {
        document.getElementById('pickerDateTime').value = moment().format('YYYY-MM-DDTHH:mm');
    }

    const DEFAULT_FORMAT = "YYYY-MM-DD HH:mm:ss Z"; 

    function formatdate(momentDate) {
        return momentDate.format(DEFAULT_FORMAT);
    }

    function getUtcValue(localDateTime){
        return moment(localDateTime).utc();
    }

    function getSelectedValue(localDateTime, timeZone) {
        return moment.tz(localDateTime, timeZone);
    }

    function getSelectedUTCValue(localDateTime, timeZone) {
        return moment.tz(localDateTime, timeZone).utc();
    }

    function getUTCConverted(utcDateTime, timeZone) {
        var utcTime = moment(Date(utcDateTime));
        return moment.tz(utcTime, timeZone);
    }

    function dropdownTimeZoneChangeEvent() {
        // Initialize the browser local timezone
        let localValue = moment().format('YYYY-MM-DDTHH:mm');
        let timeZoneValue = document.getElementById("dropdownTimeZone").value;

        document.getElementById('divLocal').innerHTML = formatdate(moment(localValue));
        document.getElementById('divUTC').innerHTML = formatdate(getUtcValue(localValue));
        document.getElementById('divSelected').innerHTML = formatdate(getSelectedValue(localValue, timeZoneValue));

        let utcSelected =  document.getElementById('divUTCSelected');
        utcSelected.innerHTML = formatdate(getSelectedUTCValue(localValue, timeZoneValue));

        let utcConverted = document.getElementById("divUTCConverted");
        utcConverted.innerHTML = formatdate(getUTCConverted(utcSelected.innerHTML, timeZoneValue));
    
        // Change to current timezone
        booking_data_1on1 = convertBookingDataUTC(booking_data_1on1);
        booking_data_group = convertBookingDataUTC(booking_data_group);

        // Change setWeekDate()
        setWeekDate(0);
    }

    // Load the script
    window.onload = function() {
        Init();
        // var offset = new Date().getTimezoneOffset();

        // document.getElementById("timezone_field").innerHTML = "Location: " + Intl.DateTimeFormat().resolvedOptions().timeZone + " (" + _offset2UTC[offset.toString()] + ")";
        // offset = -1 * offset / 60;

        // autoSelectLocalUTC(offset);

        loadDefaultDateTime();
        loadTimeZoneList();
        dropdownTimeZoneChangeEvent();
    }
</script>


</html>
