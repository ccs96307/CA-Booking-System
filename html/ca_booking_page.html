<html lang='en'>
<!--<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>--!>
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.9.1.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>


<head>
</head>

<style>
table, tr, td {
    border: 1px solid black;
    text-align: center;
}

caption {
    text-align: center;
}


.btn-pop {
    background-color: #ffd475;  
    border-radius: 10px;
    border:0px;
    zoom:200%;
}
        
#background-pop{
    display: none;
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}
       
#div-pop{
    background:#ffffff;
    width:30%;
    z-index: 1;
    margin: 12% auto;
    overflow: auto;
}
        
.div-top{
    width: 100%;
    height: auto;
    background-color: #28a3e7;
    color: #ffffff;
}
        
.div-top div {
    padding: 3px 5px 5px 8px;
 }
        
span {
    color: white;
    margin-bottom: 10px ;
    margin-left: 20px ;
    cursor: pointer;
    float: right;
}
       
.div-content {
    width: auto;
    height: 200px;
    overflow: auto;
}
        
.div-footer {
    text-align: center;
    background-color: darkgray;
}


</style>


<body>
    <!-- Personal Info --!>
    <dl>
        <dt id="user_name_field">Username: </dt>
        <dt id="user_role_field">Role: </dt>
        <dt id="user_email_field">Email: </dt>
        <dt id="timezone_field">Location: </dt>
        <dt id="local_utc_field">UTC:
            <!-- UTC --!>
            <select id="UTC_Timezone" onchange="utc_change_event()">
                <option>UTC-12</option>
                <option>UTC-11</option>
                <option>UTC-10</option>
                <option>UTC-9</option>
                <option>UTC-8</option>
                <option>UTC-7</option>
                <option>UTC-6</option>
                <option>UTC-5</option>
                <option>UTC-4</option>
                <option>UTC-3</option>
                <option>UTC-2</option>
                <option>UTC-1</option>
                <option>UTC+0</option>
                <option>UTC+1</option>
                <option>UTC+2</option>
                <option>UTC+3</option>
                <option>UTC+4</option>
                <option>UTC+5</option>
                <option>UTC+6</option>
                <option>UTC+7</option>
                <option>UTC+8</option>
                <option>UTC+9</option>
                <option>UTC+10</option>
                <option>UTC+11</option>
                <option>UTC+12</option>
                <option>UTC+13</option>
                <option>UTC+14</option>
            </select>
        </dt>
    </dl>

    <!-- Teacher Checkboxs --!>
    <div id='checkbox_container'>
        <!--<input type='checkbox' id='checkbox_teacher_id_1' name='checkbox_teacher_name_1' onclick='checkbox_event()'>
        <label id='checkbox_label_1' for='checkbox_teacher_name_1'>Clay</label>--!>
    </div>
    
    <!-- Change date button --!>
    <div style='display: flex; justify-content: space-between;'>
        <button onclick='prev()'>PREV</button>
        <button onclick='go_back_to_today()'>Go Back To Today</button>
        <button onclick='next()'>NEXT</button>
    </div>
    
    <!-- Weekly calendar --!>
    <table>
        <caption id='current_month'><h3></h3></caption>
        <tr>
            <td>Mon</td>
            <td>Tue</td>
            <td>Wed</td>
            <td>Thu</td>
            <td>Fri</td>
            <td style='color: red'>Sat</td>
            <td style='color: red'>Sun</td>
        </tr>
        <tr>
            <td id='current_mon'></td>
            <td id='current_tue'></td>
            <td id='current_wed'></td>
            <td id='current_thu'></td>
            <td id='current_fri'></td>
            <td id='current_sat'></td>
            <td id='current_sun'></td>
        </tr>
        <tr>
            <td id="current_mon_container"></td>
            <td id="current_tue_container"></td>
            <td id="current_wed_container"></td>
            <td id="current_thu_container"></td>
            <td id="current_fri_container"></td>
            <td id="current_sat_container"></td>
            <td id="current_sun_container"></td>
        </tr>
    </table>

    <!-- Teacher can set the course info --!>
    <div style="display: none" id="teacher_course_settings">
    <dl>
        <dt>
            <p>Teacher:<input type="text" id="tname" name="tname"></p>
        </dt>
        <dt>
            <p>Date:<input type="text" class="datepicker" id="datepicker"></p>
        </dt>
        <dt>
            <p>Start Time:<input type="text" class="timepicker" id="course_start_time"></p>
        </dt>
        <dt>
            <p>End Time:<input type="text" class="timepicker" id="course_end_time"></p>
        </dt>
        <dt>
            <p>Price:<input type="text" id="course_price"></p>
        </dt>
    </dl>
        <button style="float: right;" onclick="add_new_course()">CREATE</button>
    </div>

    <!-- Pop booking window --!>
    <div id="background-pop">
        <div id="div-pop">
            <div class="div-top">
                <span id="close-button">[X]</span>
                <div>Check your user information...</div>
            </div>
            <div class="div-content">
                <p>Username:<input type="text" id="pay_user_name"></p>
                <p>Email:<input type="text" id="pay_user_email"></p>
            
                <!-- Auto generate PayPal button --!>
                <div style='margin-left: auto;margin-right: auto;width:170px'>
                    <form action='https://www.sandbox.paypal.com/cgi-bin/webscr' method='post'>
                        <input type='hidden' name='cmd' value='_xclick' />
                        <input type='hidden' name='business' value='sb-3lpsb8564015@business.example.com' />
                        <input type='hidden' id='ca_booking_name' name='item_name' value='THIS_IS_A_COURSE_WITH_DATETIEM!!!!' />
                        <input type='hidden' name='currency_code' value='USD' />
                        <input type='hidden' id='ca_booking_value' name='amount' value='0.99' />
                        <input type='hidden' name='lc' value='EN_US'>
                        <input type='hidden' name='no_note' value=''>
                        <input type='hidden' name='paymentaction' value='sale'>
                        <input type='hidden' name='return' value='' />
                        <input type='hidden' name='bn' value='WPPlugin_SP'>
                        <input type='hidden' name='cancel_return' value='' />
                        <input style='border: none;' class='paypalbuttonimage' type='image' 
                            src='https://www.paypalobjects.com/webstatic/en_US/i/buttons/buy-logo-medium.png' border='0' name='submit'
                            alt='Make your payments with PayPal. It is free, secure, effective.'>
                        <img alt='' border='0' style='border:none;display:none;' src='https://www.paypal.com/EN_US/i/scr/pixel.gif' width='1' height='1'>
                    </form>
                </div>

            </div>
        </div>
    </div>

</body>




<script>
    // Settings
    var booking_data;
    var booking_keys;
    var current_utc;

    const _months = [
        'January',
        'February',
        'March',
        'April',
        'May',
        'June',
        'July',
        'August',
        'September',
        'October',
        'November',
        'December'
    ];

    const _weekdays = [
        'Sunday',
        'Monday',
        'Tuesday',
        'Wednesday',
        'Thrusday',
        'Friday',
        'Saturday',
    ];

    
    const _offset2UTC = {
        "0": "UTC+0",
        "60": "UTC-1",
        "120": "UTC-2",
        "180": "UTC-3",
        "240": "UTC-4",
        "300": "UTC-5",
        "360": "UTC-6",
        "420": "UTC-7",
        "480": "UTC-8",
        "540": "UTC-9",
        "600": "UTC-10",
        "660": "UTC-11",
        "720": "UTC-12",
        "-60": "UTC+1",
        "-120": "UTC+2",
        "-180": "UTC+3",
        "-240": "UTC+4",
        "-300": "UTC+5",
        "-360": "UTC+6",
        "-420": "UTC+7",
        "-480": "UTC+8",
        "-540": "UTC+9",
        "-600": "UTC+10",
        "-660": "UTC+11",
        "-720": "UTC+12",
        "-780": "UTC+13",
        "-840": "UTC+14",
    };

    // AJAX
    function Init() {
        $.ajax({
            type: 'POST',
            url: '../test.php',
            data: {
                'type': 'init',
            },
            dataType: 'json',
            success: function (init_data) {
                document.getElementById("user_name_field").innerHTML = "Username: " + init_data.current_user_name;
                document.getElementById("user_role_field").innerHTML = "Role: " + init_data.current_user_role;
                document.getElementById("user_email_field").innerHTML = "Email: " + init_data.current_user_email;

                checkbox_init(init_data.teachers);

                // If user role is teacher, he/she can add the new course on the booking system
                if (init_data.current_user_role == "um_teacher") {
                    document.getElementById("teacher_course_settings").style.display = 'block';
                    document.getElementById("tname").value = init_data.current_user_name;
                    document.getElementById("tname").disabled = true;
                }

                booking_data = init_data.booking_data;
                booking_keys = init_data.booking_keys;
                
                convertBookingDataUTC();
                setWeekDate(1);
                current_utc = document.getElementById("UTC_Timezone").value;
            },
            error: function (e) {
                alert(e);
                alert('something error');
            },
            beforeSned: function() {

            }
        });
    }


    function Add_New_Course(tname, _date, start_time, end_time, price) {
        var selected_utc = document.getElementById("UTC_Timezone").value;
        var utc_offset = -1 * parseInt(selected_utc.split("UTC")[1]);
        var start_time_timestamps = start_time.getTime();
        var end_time_timestamps = end_time.getTime();

        start_time.setTime(start_time_timestamps + utc_offset * 1000 * 60 * 60);
        end_time.setTime(end_time_timestamps + utc_offset * 1000 * 60 * 60);
        
        // Time
        var _st = start_time.getHours().toString() + ":" + start_time.getMinutes().toString();
        var _et = end_time.getHours().toString() + ":" + end_time.getMinutes().toString();

        $.ajax({
            type: "POST",
            url: "../test.php",
            data: {
                "type": "add_new_course",
                "teacher_name": tname,
                "date": _date,
                "start_time": _st,
                "end_time": _et,
                "price": price,
            },
            dataType: "json",
            success: function(results) {
                alert(results.message);
            },
            error: function (e) {
                alert(e);
                alert('something error');
            },
            beforeSend: function() {

            }
        });
    }

    function before_booking_check(book_course_key, book_user_name, book_user_email) {
        var book_course_key = book_course_key;
        var book_user_name = book_user_name;
        var book_user_email = book_user_email;

        alert("Before Send AJAX");

        $.ajax({
            type: 'POST',
            url: '../test.php',
            data: {
                'type': 'before_booking_check',
                'book_course_key': book_course_key,
                'book_user_name': book_user_name,
                'book_user_email': book_user_email,
            },
            dataType: 'json',
            success: function (check_results) {
                if (check_results.results == "ok") {
                    payEvent(ca_booking_name, ca_booking_value);
                }
                else if (check_results.results == "wait for payment") {
                    payEvent(ca_booking_name, ca_booking_value);
                }
                else if (check_results.results == "not you") {
                    alert("The course is booked by other people!");
                }
                else {
                    alert("The course is booked.");
                }
            },
            error: function (e) {
                alert(e);
                alert('something error');
            },
            beforeSned: function() {

            }
        });
    }

    // Init
    var _date = new Date();
    if (_date.getDay() == 0) {
        _date.setDate(_date.getDate() - 6);
    }
    else {
        _date.setDate(_date.getDate()-_date.getDay()+1);
    }

    // Format method
    function formatDate(format_date) {
        let month = (1 + format_date.getMonth()).toString().padStart(2, '0');
        let day = format_date.getDate().toString().padStart(2, '0');

        return month + '/' + day;
    }

    // Checkbox events
    function checkbox_event() {
        var checkbox = document.getElementById('checkbox_teacher_id_1');
        var label = document.getElementById('checkbox_label_1');

        // If checked
        if (checkbox.checked == true) {
            label.innerHTML = 'Atlas';
        }
        else {
            label.innerHTML = 'Clay';
        }
    }

    // Checkbox init
    function checkbox_init(names) {
        // Add checkboxs
        for (var i=0; i<names.length; ++i) {
            // Container
            var container = document.getElementById("checkbox_container");

            // Checkbox
            var checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.name = names[i];
            checkbox.value = i;
            checkbox.id = i;
            checkbox.onclick = function() {
                // TODO
            };
        
            // Label
            var label = document.createElement("label");
            label.htmlFor = i;
            label.appendChild(document.createTextNode(names[i]));
            
            // <br> element
            var br = document.createElement("br");
            
            // Append
            container.appendChild(checkbox);
            container.appendChild(label);
            container.appendChild(br);
        }
    }

    // Convert UTC
    function convertBookingDataUTC() {
        for (let i=0; i<booking_data.length; ++i) {
        //for (var key in booking_data) {
            var _date = booking_data[i]["date"];
            var _st = booking_data[i]["start_time"];
            var _et = booking_data[i]["end_time"];
            
            var _start_time = new Date(_date);
            _start_time.setHours(parseInt(_st.split(":")[0], parseInt(_st.split(":")[1]), 0));
                
            var _end_time = new Date(_date);
            _end_time.setHours(parseInt(_et.split(":")[0], parseInt(_et.split(":")[1]), 0));

            // Current UTC
            var selected_utc = document.getElementById("UTC_Timezone").value;
            var utc_offset = parseInt(selected_utc.split("UTC")[1]);

            // Convert
            _start_time.setTime(_start_time.getTime() + utc_offset * 1000 * 60 * 60);
            _end_time.setTime(_end_time.getTime() + utc_offset * 1000 * 60 * 60);

            // Save
            // Date
            var y = _start_time.getFullYear().toString();
            var m = _start_time.getMonth() + 1;
            if (m < 10) m = "0" + m.toString();
            else m = m.toString();
            var d = _start_time.getDate();
            if (d < 10) d = "0" + d.toString();
            var _date = y + "-" + m + "-" + d;

            // Time
            var _st = _start_time.getHours().toString() + ":" + _start_time.getMinutes().toString();
            var _et = _end_time.getHours().toString() + ":" + _end_time.getMinutes().toString();

            booking_data[i]["date"] = _date;
            booking_data[i]["start_time"] = _st;
            booking_data[i]["end_time"] = _et;
        }
    }

    // Convert UTC from current to new
    function utc_change_event() {
        remove_all_display_booking_data();
        var selected_utc = document.getElementById("UTC_Timezone").value;
        var new_utc = parseInt(selected_utc.split("UTC")[1]);
        var old_utc = parseInt(current_utc.split("UTC")[1]);
        var utc_offset = new_utc - old_utc;

        // Update
        current_utc = selected_utc;
        
        for (let i=0; i<booking_data.length; ++i) {
        //for (var key in booking_data) {
            var _date = booking_data[i]["date"];
            var _st = booking_data[i]["start_time"];
            var _et = booking_data[i]["end_time"];
            
            var _start_time = new Date(_date);
            _start_time.setHours(parseInt(_st.split(":")[0], parseInt(_st.split(":")[1]), 0));
                
            var _end_time = new Date(_date);
            _end_time.setHours(parseInt(_et.split(":")[0], parseInt(_et.split(":")[1]), 0));
            
            // Convert
            _start_time.setTime(_start_time.getTime() + utc_offset * 1000 * 60 * 60);
            _end_time.setTime(_end_time.getTime() + utc_offset * 1000 * 60 * 60);

            // Save
            // Date
            var y = _start_time.getFullYear().toString();
            var m = _start_time.getMonth() + 1;
            if (m < 10) m = "0" + m.toString();
            else m = m.toString();
            var d = _start_time.getDate();
            if (d < 10) d = "0" + d.toString();
            var _date = y + "-" + m + "-" + d;

            // Time
            var _st = _start_time.getHours().toString() + ":" + _start_time.getMinutes().toString();
            var _et = _end_time.getHours().toString() + ":" + _end_time.getMinutes().toString();

            booking_data[i]["date"] = _date;
            booking_data[i]["start_time"] = _st;
            booking_data[i]["end_time"] = _et;
        }

        setWeekDate(0);
    }


    // Set date
    function setWeekDate(direction) {
        // Direction
        if (direction == -1) {
            _date.setDate(_date.getDate()-14);
        }
        if (direction == 0) {
            _date.setDate(_date.getDate()-7);
        }

        // Months and Years
        const months = [];
        const years = [];

        // Current weekday
        months[0] = _date.getMonth();
        years[0] = _date.getFullYear();
        
        let weekday_ids = [
            'current_mon',
            'current_tue',
            'current_wed',
            'current_thu',
            'current_fri',
            'current_sat',
            'current_sun'
        ];

        for (let i=0; i<7; ++i) {
            document.getElementById(weekday_ids[i]).innerHTML = formatDate(_date);
            _date.setDate(_date.getDate()+1);

            if (months[0] != _date.getMonth()) months[1] = _date.getMonth();
            if (years[0] != _date.getFullYear()) years[1] = _date.getFullYear();

            // Display Course info
            var y = _date.getFullYear();
            var m = _date.getMonth() + 1;
            if (m < 10) m = "0" + m.toString();
            else m = m.toString();
            var d = _date.getDate();
            if (d < 10) d = "0" + d.toString();
            else d = d.toString();
            cur_date = y + "-" + m + "-" + d;

            // Button template
            var button_num = 0;
            var td_container = document.getElementById(weekday_ids[i]+"_container");
            //var book_button = document.createElement("input");
            //book_button.type = "button";

            for (var j=0; j<booking_data.length; ++j) {
            //for (var key in booking_data)
                if (cur_date == booking_data[j]["date"]) {
                    var st_h = booking_data[j]["start_time"].split(":")[0];
                    var st_m = booking_data[j]["start_time"].split(":")[1];
                    var et_h = booking_data[j]["end_time"].split(":")[0];
                    var et_m = booking_data[j]["end_time"].split(":")[1];
                    
                    if (parseInt(st_h) < 10) st_h = "0" + st_h;
                    if (parseInt(st_m) < 10) st_m = "0" + st_m;
                    if (parseInt(et_h) < 10) et_h = "0" + et_h;
                    if (parseInt(et_m) < 10) et_m = "0" + et_m;

                    var book_button = document.createElement("input");
                    book_button.type = "button";
                    book_button.value = st_h + ":" + st_m + "-" + et_h + ":" + et_m + "\n$" + booking_data[j]["price"] + " USD";

                    if (booking_data[j]["status"] == "booked") {
                        book_button.value += "\n(booked)";
                    }
                    else if (booking_data[j]["status"] == "booking") {
                        book_button.value += "\n(waiting for payment...)";
                    }
                    
                    // Attribute "name" is store the key and data index
                    // ------------------------------------------------
                    book_button.name = j.toString();
                    // ------------------------------------------------

                    book_button.onclick = bookButtonEvent;

                    td_container.appendChild(book_button);
                    ++button_num;
                }
            }
            
            // TODO: if button_num == 0 set a message
        }

        // Current Month and Year
        if (months.length == 2 && years.length == 2) {
            document.getElementById('current_month').innerHTML = _months[months[0]] + ' ' + years[0] + ' - ' + _months[months[1]] + years[1];
        }
        else if (months.length == 2) {
            document.getElementById('current_month').innerHTML = _months[months[0]] + ' ' + years[0] + ' - ' + _months[months[1]] + years[0];         
        }
        else {
            document.getElementById('current_month').innerHTML = _months[_date.getMonth()] + ' ' + _date.getFullYear();
        }
    }

    // UTC timezone select
    function autoSelectLocalUTC(n) {
        var n = n + 12;
        document.getElementById('UTC_Timezone').selectedIndex = n;
    }


    // Move display week event
    function next() {
        remove_all_display_booking_data();
        setWeekDate(1);
    }

    function prev() {
        remove_all_display_booking_data();
        setWeekDate(-1);
    }

    function go_back_to_today() {
        remove_all_display_booking_data();
        _date = new Date();
        _date.setDate(_date.getDate()-_date.getDay()+1);
        setWeekDate(1);
    }

    function remove_all_display_booking_data() {
        
        let weekday_ids = [
            'current_mon',
            'current_tue',
            'current_wed',
            'current_thu',
            'current_fri',
            'current_sat',
            'current_sun'
        ];

        for (let i=0; i<7; ++i) {
            var td_container = document.getElementById(weekday_ids[i]+"_container");
            while (td_container.lastElementChild) {
                td_container.removeChild(td_container.lastElementChild);
            }
        }
    }


    // Calendar widget
    $(function() {
        $( "#datepicker" ).datepicker({
            dateFormat: "yy-mm-dd",
        });

        $(".timepicker").timepicker({
            "timeFormat": "H:mm"
        });
    });

    // Determine a text is a number or not
    function isNumber(inputData) {
        return parseFloat(inputData).toString() != "NaN";
    }

    // Add new course
    function add_new_course() {
        // Instance
        var datepicker_object = document.getElementById("datepicker");
        var course_start_time_object = document.getElementById("course_start_time");
        var course_end_time_object = document.getElementById("course_end_time");
        var course_price_object = document.getElementById("course_price");

        // Check
        if (datepicker_object.value == "") {
            alert("The date field cannot be empty!");
        }
        else if (course_start_time_object.value == "") {
            alert("The start time field cannot be empty!");
        }
        else if (course_end_time_object.value == "") {
            alert("The end time field cannot be empty!");
        }
        else if (course_price_object.value == "") {
            alert("The price field cannot be empty!");
        }
        else if (isNumber(course_price_object.value) == false) {
            alert("The price must be a number!");
        }
        else {
            var start_time = course_start_time_object.value;
            var end_time = course_end_time_object.value;
            var start_hour = parseInt(start_time.split(":")[0]);
            var start_min = parseInt(start_time.split(":")[1]);
            var end_hour = parseInt(end_time.split(":")[0]);
            var end_min = parseInt(end_time.split(":")[1]);

            // Re-declare start_time and end_time
            var start_time = new Date(datepicker_object.value);
            var end_time = new Date(datepicker_object.value);
            start_time.setHours(start_hour, start_min, 0);
            end_time.setHours(end_hour, end_min, 0);

            // Check
            if (start_time < end_time) {
                Add_New_Course(
                    document.getElementById("tname").value,
                    datepicker_object.value,
                    start_time,
                    end_time,
                    course_price_object.value,
                );
                var successed_message = "The course " + datepicker_object.value + " " + course_start_time_object.value + "-" + course_end_time_object.value + " ($" + course_price_object.value + " USD) is add to the booking system!";
                alert(successed_message);
                datepicker_object.value = "";
                course_start_time_object.value = "";
                course_end_time_object.value = "";
                course_price_object.value = "";
                window.location.reload();
            }
            else {
                alert("結束時間不可以設定得比開始時間早！");
            }    
        }
    }

    // Book button event
    function bookButtonEvent() {
        alert("Enter bookButtonEvent!");
        alert(this.name);

        ca_booking_name = booking_keys[parseInt(this.name)];
        ca_booking_value = booking_data[parseInt(this.name)]["price"];

        if (document.getElementById("user_name_field").innerHTML == "Username: null") {
            alert("you must be logged in for booking.");
            location.replace("https://allthing-can.com/login/");
        }
        else {
            //window.confirm("Do you want to book?");
            if (window.confirm("Do you want to book?") == true) {
                alert("YES!");
                
                var book_user_name = document.getElementById("user_name_field").innerHTML.split(" ")[1];
                var book_user_email = document.getElementById("user_email_field").innerHTML.split(" ")[1];
        
                before_booking_check(ca_booking_name, book_user_name, book_user_email);
            } 
            else {
                alert("CANCEL!");
            }
        }
    }

    function payEvent(ca_booking_name, ca_booking_value) {
        // PayPal button
        document.getElementById("ca_booking_name").value = ca_booking_name;
        document.getElementById("ca_booking_value").value = ca_booking_value;

        // Show or Hide
        var div = document.getElementById("background-pop");
        var close = document.getElementById("close-button");

        // User info
        var book_user_name = document.getElementById("user_name_field").innerHTML.split(" ")[1];
        var book_user_email = document.getElementById("user_email_field").innerHTML.split(" ")[1];
        document.getElementById("pay_user_name").value = book_user_name;
        document.getElementById("pay_user_email").value = book_user_email;

        div.style.display = "block";

        close.onclick = function close() {
            div.style.display = "none";
        }

        window.onclick = function close(e) {
            if (e.target == div) {
                div.style.display = "none";
            }
        }

        // Book event
        book(ca_book_name, book_user_name, book_user_email);
    }

    // Load the script
    window.onload = function() {
        // Init
        Init();
        
        var offset = new Date().getTimezoneOffset();
        
        document.getElementById("timezone_field").innerHTML = "Location: " + Intl.DateTimeFormat().resolvedOptions().timeZone + " (" + _offset2UTC[offset.toString()] + ")";

        offset = -1 * offset / 60;
        autoSelectLocalUTC(offset);
    }

</script>


</html>
